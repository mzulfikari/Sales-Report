{% extends "dashbord/manager/base.html" %}
{% block title %}سروریس جدید{% endblock title %}
{% load static %}
{% load jalali_tags %} 
{% block content %}

<!-- BEGIN CSS -->
<link href="{% static 'css\inputcar.css' %}" rel="stylesheet">
<!-- BEGIN PAGE CONTENT -->
<div id="page-content">
    <div id="inner-content">
        <div class="row">
            <!-- BEGIN BREADCRUMB -->
            <div class="col-md-12">
                <div class="breadcrumb-box shadow">
                    <ul class="breadcrumb">
                        <li><a href="dashboard.html">پیشخوان</a></li>
                        <li><a href="#">فرم ها</a></li>
                        <li class="active">فرم ها</li>
                    </ul>
                    <div class="breadcrumb-left" style="font-weight: bold;">
                       {% jalali_now "%Y-%m-%d" %}
                        <i class="icon-calendar"></i>
                    </div><!-- /.breadcrumb-left -->
                </div><!-- /.breadcrumb-box -->
            </div><!-- /.col-md-12 -->
            <!-- END BREADCRUMB -->

            <div class="col-lg-6">
                <div class="portlet box shadow">
                    <div class="portlet-heading">
                        <div class="portlet-title">
                            <h3 class="title">
                                <i class="icon-settings"></i>
                                مشخصات خودرو
                            </h3>
                        </div>
                        <!-- /.portlet-title -->
                    </div>
                    <!-- /.portlet-heading -->
                    <div class="portlet-body">
                        <form role="form" method="post">
                            {% csrf_token %}
                            <div class="form-body">
                                <div class="form-group">
                                    <div class="form-inline-group">
                                        <div class="mb-4">
                                            <label for="{{ form.customer_phone.id_for_label }}" class="inline-label">
                                                {{ form.customer_phone.label }}
                                            </label>
                                        </div>
                                        {{ form.customer_phone }}
                                        
                                    </div>
                                    <!-- /.form-group -->
                                    <div class="form-inline-group">
                                        <div class="mb-4">
                                            <label for="{{ form.car.id_for_label }}" class="inline-label">
                                                {{ form.car.label }}
                                            </label>
                                        </div>
                                        {{form.car}}
                                        {% if form.car.errors %}
                                        <div class="flex items-center gap-2 text-red-600 text-sm mt-1">
                                            <i class="bi bi-exclamation-circle-fill"></i>
                                            <ul class="list-none m-0 p-0">
                                                {% for error in form.car.errors %}
                                                <li>{{ error }}</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <!-- /.form-group -->
                                    <div class="form-inline-group">
                                        <div class="mb-4">
                                            <label for="{{ form.plaque.id_for_label }}" class="inline-label">
                                                {{ form.plaque.label }}
                                            </label>
                                        </div>

                                        <div class="d-flex gap-2 align-items-center" style="direction: ltr;">
                                            {% for widget in form.plaque %}
                                            {{ widget }}
                                            {% endfor %}
                                        </div>

                                        {% if form.plaque.errors %}
                                        <div class="flex items-center gap-2 text-red-600 text-sm mt-1">
                                            <i class="bi bi-exclamation-circle-fill"></i>
                                            <ul class="list-none m-0 p-0">
                                                {% for error in form.plaque.errors %}
                                                <li>{{ error }}</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <!-- /.form-group -->
                                <div class="form-inline-group">
                                    <div class="mb-4">
                                        <label for="{{ form.car_model.id_for_label }}" class="inline-label">
                                            {{ form.car_model.label }}
                                        </label>
                                    </div>
                                    {{form.car_model}}
                                    {% if form.car_model.errors %}
                                    <div class="flex items-center gap-2 text-red-600 text-sm mt-1">
                                        <i class="bi bi-exclamation-circle-fill"></i>
                                        <ul class="list-none m-0 p-0">
                                            {% for error in form.car_model.errors %}
                                            <li>{{ error }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <!-- /.form-group -->
                            <div class="form-inline-group">
                                <div class="mb-4">
                                    <label for="{{ form.current_kml.id_for_label }}" class="inline-label">
                                        {{ form.current_km.label }}
                                    </label>
                                </div>
                                {{form.current_km}}

                                {% if form.current_km.errors %}
                                <ul class="text-red-600 text-sm mt-1 list-none p-0">
                                    {% for error in form.current_km.errors %}
                                    <li>{{ error }}</li>
                                    {% endfor %}
                                </ul>
                                {% endif %}
                            </div>
                    </div>
                    <!-- /.form-group -->
                    <div class="form-inline-group">
                        <div class="mb-3">
                            <label for="{{ form.color.id_for_label }}" class="inline-label">
                                {{ form.color.label }}
                            </label>
                        </div>
                        <div class="col-sm-9">
                            <select class="form-select" name="color">
                                {% for value, label in form.fields.color.choices %}
                                <option value="{{ value }}" {% if form.color.value == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="form-group relative">
                        <label class="inline-label mb-2 d-block">تصویر پلاک</label>
                        <div class="input-group round">
                            <input type="file" id="plate-image" name="image" accept="image/*" class="hidden" />
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-success"
                                    onclick="document.getElementById('plate-image').click();">
                                    <i class="icon-picture"></i> انتخاب تصویر
                                </button>
                            </span>
                            <span id="file-name" class="ml-2 text-muted small"></span>
                        </div>
                        <div id="preview" class="mt-3 hidden">
                            <img src="" alt="پیش‌نمایش تصویر" class="img-thumbnail"
                                style="max-width: 100%; height: auto;" />
                        </div>
                    </div>

                    <div class="form-group relative">
                        <input type="file" class="form-control">

                        <div class="mb-4">
                            <label class="inline-label">
                                تصویر پلاک
                            </label>
                            <div class="input-group round">
                                <input type="file" name="image" class="hidden" accept="image/*" />
                                <span class="input-group-btn">
                                    <button type="submit" class="btn btn-success">
                                        <i class="icon-picture"></i>
                                        تصویر کیلومتر فعلی
                                    </button>
                                </span>
                            </div><!-- /.input-group -->
                            <div class="help-block"></div>
                        </div><!-- /.form-group -->
                    </div>
                    <!-- /.form-body -->
                    <div class="form-actions text-center">
                        <button type="submit" class="btn btn-success btn-round btn-lg">
                            <i class="icon-check"></i>
                            ادامه
                        </button>
                    </div>
                    <!-- /.form-actions -->

                </div>

                <!-- /.portlet-body -->
            </div>
            </form>
            <!-- /.portlet -->
            <!-- بعد JS لود شود -->
<script src="{% static 'toastify/toastify.min.js' %}"></script>
            <script>
                document.addEventListener("DOMContentLoaded", function() {
                    const inputs = document.querySelectorAll(".plaque-input");
                    inputs.forEach((input, index) => {
                        input.addEventListener("input", function() {
                            const maxLength = input.getAttribute("maxlength");
                            if (input.value.length >= maxLength) {
                                const nextInput = inputs[index + 1];
                                if (nextInput) {
                                    nextInput.focus();
                                }
                            }
                        });
                        input.addEventListener("keydown", function(e) {
                            if (e.key === "Backspace" && input.value.length === 0) {
                                const prevInput = inputs[index - 1];
                                if (prevInput) {
                                    prevInput.focus();
                                }
                            }
                        });
                    });
                });
            </script>

<script>
{% if errors %}
    {% for error in errors %}
        Toastify({
            text: "{{ error|escapejs }}",
            duration: 5000,
            close: true,
            gravity: "top",
            position: "right",
            backgroundColor: "linear-gradient(to right, #ff5f6d, #ffc371)"
        }).showToast();
    {% endfor %}
{% endif %}
</script>

            {% endblock %}